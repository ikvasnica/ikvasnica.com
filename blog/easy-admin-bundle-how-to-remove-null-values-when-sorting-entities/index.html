<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="PHP, Symfony, programming tips and tricks by Ivan Kvasnica.">
    <meta name="author" content="Ivan Kvasnica">
    <meta name="keywords" content="EasyAdmin, bundle, Symfony, PHP, Doctrine, query, sort">
    <link rel="canonical" href="https://ikvasnica.com/blog/easy-admin-bundle-how-to-remove-null-values-when-sorting-entities/">

    <title>
        EasyAdmin Bundle: How to remove null values when sorting entities | PHP &amp; Symfony Tips
    </title>

        <!-- Bootstrap Core CSS -->
        <link href="/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="/css/clean-blog.min.css" rel="stylesheet">

        <!-- Highlight.js -->
        <link rel="stylesheet" href="/css/atom-one-dark.css">

        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
</head>


<body>

<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">


                    <li class=" index-1 first">

                        <a href="https://ikvasnica.com/blog/" title='All posts'>
                            All posts
                        </a>

                    </li>


                    <li class=" index-2">

                        <a href="https://ikvasnica.com/" title='Portfolio'>
                            Portfolio
                        </a>

                    </li>


                    <li class=" index-3 last">

                        <a href="/rss.xml" title='RSS'>
                            RSS
                        </a>

                    </li>


            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>        <!-- Facebook stuff -->
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.8&appId=1715191915471013";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <a href="/blog">&larr; Go back</a>
                        <h1>EasyAdmin Bundle: How to remove null values when sorting entities</h1>
                        <span class="meta">by <em>Ivan Kvasnica</em>, 17.01.2017
 - <a href="/blog/easy-admin-bundle-how-to-remove-null-values-when-sorting-entities/#disqus_thread">Comment</a><br>
</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Post Content -->
    <article>
        <div class="container">
            <div id="article-body" class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    
<p><strong>Some web applications have a secret.</strong> I mean, an administration interface. You know, that part of the website behind the <em>/admin</em> you don’t want to expose (especially if you don’t care about cross-site scripting vulnerabilities).</p>
<p>But you rarely develop these interfaces on your own. There are plenty of Symfony bundles to deal with this issue. Right now, I am working with <a href="https://github.com/javiereguiluz/EasyAdminBundle">the EasyAdmin bundle</a>. It is straightforward, solves more or less all common problems and is really easy to use. All the configuration is done via YAML files.</p>
<p>However, as our system was growing over time, <strong>very specific needs began to rise that are not solvable in the non-coding way.</strong></p>
<p>For instance, <strong>sorting a timestamp field on an entity</strong>. Looks like a trivial problem, right? Wrong. It turned out that EasyAdmin doesn’t filter out <em>null</em> values from the field. So when a user wants to see, for example, the most recent logged in users, she will see users who have not logged yet instead. <strong>Quite an opposite result!</strong></p>
<p>Fortunately, Easy Admin comes <a href="https://github.com/javiereguiluz/EasyAdminBundle/blob/master/Resources/doc/book/7-complex-dynamic-backends.md">with a bunch of events</a> you can hook into. I decided to solve the problem in a way that <strong>the <em>null</em> results are not visible at all</strong> when sorting a specific timestamp field on a specific entity. If you have another idea for a solution, feel free to drop a comment below.</p>
<h2>1. Create a kernel event subscriber</h2>
<p>...or listener, if you prefer. Subscriber to the _POST_LIST_QUERY<em>BUILDER</em>, so <strong>we can modify an already created </strong><em><strong>QueryBuilde</strong>r</em> and thus SQL query, coming from the EasyAdmin bundle.</p>
<pre><code class="language-php">namespace AppBundle\Subscriber;

use JavierEguiluz\Bundle\EasyAdminBundle\Event\EasyAdminEvents;
use Symfony\Component\EventDispatcher\EventSubscriberInterface;
use Symfony\Component\EventDispatcher\GenericEvent;
use Doctrine\Common\Collections\Criteria;

class EasyAdminSubscriber implements EventSubscriberInterface
{

    public static function getSubscribedEvents()
    {
        return [
            EasyAdminEvents::POST_LIST_QUERY_BUILDER =&gt; 'lastLoginSortWithoutNull',
        ];
    }</code></pre>
<p>And don't forget to register it in <em>services.yml.</em></p>
<pre><code>services:  
  app.easyadmin_subscriber:
    class: AppBundle\Subscriber\EasyAdminSubscriber
    tags:
      - { name: kernel.event_subscriber }</code></pre>
<h2>2. Limit the subscriber</h2>
<p>Create the method to do the magic. You should apply the filter only to entities and/or fields it is necessary. <strong>Be careful,</strong> otherwise you might break something else.</p>
<pre><code class="language-php">public function lastLoginSortWithoutNull(GenericEvent $event)
{
        // get necessary variables from the event
        $subject = $event-&gt;getSubject();
        $sortField = $event-&gt;getArgument('sort_field');

        // apply only when user is sorting by lastLogin in the User entity
        if ($subject['name'] !== 'User' || $sortField !== 'lastLogin') {
            return;
        }

        /* ... */
}</code></pre>
<h2>3. Apply a Criteria</h2>
<p>Doctrine comes up with a handy helper to solve exactly these kind of problems. It's called <em>Criteria</em> and, as the name suggests, <strong>you can add another criteria to an existing <em>QueryBuilder</em></strong>. In our case, we don't want rows with <em>lastLogin</em> of <em>null</em>.</p>
<pre><code class="language-php">public function lastLoginSortWithoutNull(GenericEvent $event)
{
        /* ... */

        // filter out NULL values from the result set
        $queryBuilder = $event-&gt;getArgument('query_builder');
        $criteria = Criteria::create()-&gt;where(Criteria::expr()-&gt;neq('lastLogin', null));
        $queryBuilder-&gt;addCriteria($criteria);
}</code></pre>
<p><strong>And that's it!</strong> The <em>QueryBuilder</em> is now modified and will return only User entities that have been logged in at least once.</p>
<p>You can use <em>Criteria</em> in many places and I suggest that you <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/working-with-associations.html#filtering-collections">read their documentation</a>, because it's a powerful tool. It works on the SQL level so performance is much better than filtering array collections, for instance.</p>                </div>
            </div>

            <!-- Social media share buttons -->
                <aside class="row" style="margin-bottom: 20px;">
                    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

Deprecated: "{$post|similarPosts} Latte filter was deprecated and will be removed in Statie 3.0. Use {$post|relatedPosts} instead." in /home/travis/build/ikvasnica/ikvasnica.com/vendor/symplify/statie/packages/RelatedPosts/src/Latte/Filter/RelatedPostsFilter.php on line 38

Call Stack:
    0.0001     362432   1. {main}() /home/travis/build/ikvasnica/ikvasnica.com/vendor/symplify/statie/bin/statie:0
    0.0002     370832   2. include_once('/home/travis/build/ikvasnica/ikvasnica.com/vendor/symplify/statie/bin/statie.php') /home/travis/build/ikvasnica/ikvasnica.com/vendor/symplify/statie/bin/statie:4
    0.1700    6847968   3. Symfony\Component\Console\Application->run() /home/travis/build/ikvasnica/ikvasnica.com/vendor/symplify/statie/bin/statie.php:43
    0.1788    7089248   4. Symfony\Component\Console\Application->doRun() /home/travis/build/ikvasnica/ikvasnica.com/vendor/symfony/console/Application.php:125
    0.1791    7089248   5. Symfony\Component\Console\Application->doRunCommand() /home/travis/build/ikvasnica/ikvasnica.com/vendor/symfony/console/Application.php:224
    0.1791    7089248   6. Symplify\Statie\Console\Command\GenerateCommand->run() /home/travis/build/ikvasnica/ikvasnica.com/vendor/symfony/console/Application.php:888
    0.1804    7093976   7. Symplify\Statie\Console\Command\GenerateCommand->execute() /home/travis/build/ikvasnica/ikvasnica.com/vendor/symfony/console/Command/Command.php:262
    0.1804    7093976   8. Symplify\Statie\Application\StatieApplication->run() /home/travis/build/ikvasnica/ikvasnica.com/vendor/symplify/statie/src/Console/Command/GenerateCommand.php:43
    0.1989    7629552   9. Symplify\Statie\Application\StatieApplication->processTemplates() /home/travis/build/ikvasnica/ikvasnica.com/vendor/symplify/statie/src/Application/StatieApplication.php:63
    0.1992    7648656  10. Symplify\Statie\Renderable\RenderableFilesProcessor->processFiles() /home/travis/build/ikvasnica/ikvasnica.com/vendor/symplify/statie/src/Application/StatieApplication.php:105
    0.2291    7750200  11. Symplify\Statie\Renderable\Latte\LatteFileDecorator->decorateFiles() /home/travis/build/ikvasnica/ikvasnica.com/vendor/symplify/statie/src/Renderable/RenderableFilesProcessor.php:64
   12.4712    9537808  12. Symplify\Statie\Renderable\Latte\LatteFileDecorator->decorateFile() /home/travis/build/ikvasnica/ikvasnica.com/vendor/symplify/statie/src/Renderable/Latte/LatteFileDecorator.php:48
   12.4713    9538616  13. Symplify\Statie\Renderable\Latte\LatteFileDecorator->renderToString() /home/travis/build/ikvasnica/ikvasnica.com/vendor/symplify/statie/src/Renderable/Latte/LatteFileDecorator.php:79
   12.4713    9538728  14. Symplify\Statie\FlatWhite\Latte\LatteRenderer->renderExcludingHighlightBlocks() /home/travis/build/ikvasnica/ikvasnica.com/vendor/symplify/statie/src/Renderable/Latte/LatteFileDecorator.php:127
   12.4714    9545232  15. Latte\Engine->renderToString() /home/travis/build/ikvasnica/ikvasnica.com/vendor/symplify/statie/packages/FlatWhite/src/Latte/LatteRenderer.php:68
   12.4850    9481496  16. Template5d05448ac7->capture() /home/travis/build/ikvasnica/ikvasnica.com/vendor/latte/latte/src/Latte/Engine.php:81
   12.4850    9498816  17. Template5d05448ac7->render() /home/travis/build/ikvasnica/ikvasnica.com/vendor/latte/latte/src/Latte/Runtime/Template.php:326
   12.4851    9506032  18. Template1826d3db16->render() /home/travis/build/ikvasnica/ikvasnica.com/vendor/latte/latte/src/Latte/Runtime/Template.php:176
   12.4852    9510984  19. Templatea961852caf->render() /home/travis/build/ikvasnica/ikvasnica.com/vendor/latte/latte/src/Latte/Runtime/Template.php:176
   12.4852    9511440  20. Templatea961852caf->main() /home/travis/build/ikvasnica/ikvasnica.com/vendor/latte/latte/src/Latte/Runtime/Template.php:198
   12.4855    9515520  21. Templatea961852caf->renderBlock() /tmp/_flat_white_latte_factory_cache/a961852caf.php:65
   12.4855    9515544  22. Template1826d3db16->blockContent() /home/travis/build/ikvasnica/ikvasnica.com/vendor/latte/latte/src/Latte/Runtime/Template.php:282
   12.4857    9517912  23. Symplify\Statie\RelatedPosts\Latte\Filter\RelatedPostsFilter->Symplify\Statie\RelatedPosts\Latte\Filter\{closure}() /tmp/_flat_white_latte_factory_cache/1826d3db16.php:120
   12.4857    9517912  24. trigger_error() /home/travis/build/ikvasnica/ikvasnica.com/vendor/symplify/statie/packages/RelatedPosts/src/Latte/Filter/RelatedPostsFilter.php:38

                    </div>
                </aside>

                <section id="social-buttons" class="row">
                    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                        <div class="fb-like" data-layout="button_count" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>

                        <a href="https://twitter.com/share" class="twitter-share-button" data-via="ikvasnica" data-dnt="true" data-show-count="false">Tweet</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


                        <script src="//platform.linkedin.com/in.js" type="text/javascript"> lang: en_US</script>
                        <script type="IN/Share"></script>

                        <!-- Facebook button align hack -->
                        <style media="screen" type="text/css">
                            .fb_iframe_widget span
                            {
                                vertical-align: baseline !important;
                            }
                        </style>
                    </div>
                </section>
        </div>
    </article>

<aside id="author-bio">
    <div class="container">
        <div class="row">
            <div id="bio-photo" class="col-lg-2 col-lg-offset-2 col-md-1 col-md-offset-1">
                <img src="/img/bio_ivan.png" alt="Ivan Kvasnica">
            </div>
            <div class="col-lg-6 col-md-9 col-xs-10">
                <h3>Ivan Kvasnica</h3>
                <p><a href="http://twitter.com/ikvasnica" target="_blank">@ikvasnica</a> is a Symfony & Drupal developer at <a href="http://www.b.cz" target="_blank">Business Factory</a>, working
                    on <a href="http://www.iprima.cz" target="_blank">TV Prima</a>'s projects. In past, he used to live in Norway, Denmark
                    and Slovakia, and wrote <a href="http://www.zive.sk/profil-autora/469/ivan-kvasnica" target="_blank">hundreds of articles on IT topics</a>.
                    He likes organizing <a href="https://www.facebook.com/groups/englishinbrno/" target="_blank">international events</a> and traveling.</p>
            </div>
        </div>
    </div>
</aside>
<section>
    <div class="container">
        <div class="row">
            <div id="disqus_thread" class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            </div>
        </div>
    </div>
</section>

<script>
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://ikvasnica-com-blog.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<!-- Footer -->
<hr>

<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="https://twitter.com/ikvasnica">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.linkedin.com/in/ikvasnica">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/ikvasnica">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/js/bootstrap.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="/js/clean-blog.min.js"></script>

    <!-- Highlight.js -->
    <script src="/js/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <script id="dsq-count-scr" src="//ikvasnica-com-blog.disqus.com/count.js" async></script>

    <!-- Google Analytics -->
    <script>
        (function(i,s,o,g,r,a,m){ i ['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-76354460-2', 'auto');
        ga('send', 'pageview');

    </script>

</body>

</html>